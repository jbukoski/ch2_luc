lulcc <- crosstab(lulc2000, lulc2014, useNA=FALSE)
lulcc_df <- as.data.frame.matrix(round(lulcc * 900 / 10000 / 1000, 2))
lulcc_df$sum <- rowSums(lulcc_df)
library(tidyverse)
in_dir <- "./data/"
dat <- read_csv(paste0(in_dir, "scratch/extent_estimates.csv"))
dat
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw()
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw() +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
theme(legend.position = "bottom",
legend.title = "none")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
theme(legend.position = "bottom",
legend.title = element_blank())
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
theme(legend.position = "bottom",
legend.title = element_text("Source"))
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
guide_legend(title = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge") +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
library(sf)
sf
?sf
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge", width = 0.1) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge", width = 1) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge", width = 0.5) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity", position = "dodge", width = 2) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 0.9, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 2, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 2, preserve = "total")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 2, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 5, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 1, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 10, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 100, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 10000, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
dat <- read_csv(paste0(in_dir, "scratch/extent_estimates.csv"))
dat
ggplot(dat, aes(x = Year, y = Extent_ha)) +
geom_bar(aes(fill = as.factor(Reference)), stat = "identity",
position = position_dodge2(width = 10000, preserve = "single")) +
stat_smooth() +
theme_bw() +
ylab("Extent of Mangroves (ha)") +
labs(fill = "Source") +
theme(legend.position = "bottom")
lulcc_df
write_csv(lulcc_df, "~/Desktop/lulcc.csv")
read_sf("~/Documents/dmcr_data/Land use (2000 and 2014)/mg2000.shp")
read_sf("~/Documents/dmcr_data/Land use (2000 and 2014)/mg2000.shp") %>%
mutate(CODE = ifelse(CODE == "Mi", "Unk", CODE)) %>%
arrange(CODE)
sf_dat <- read_sf("~/Documents/dmcr_data/Land use (2000 and 2014)/MG_TYPE_43.shp") %>%
mutate(CODE = ifelse(CODE == "Mi", "Unk", CODE)) %>%
arrange(CODE) %>%
mutate(CODE_NUM = 1:length(CODE)) %>%
dplyr::select(CODE, CODE_NUM)
library(sf)
sf_dat <- read_sf("~/Documents/dmcr_data/Land use (2000 and 2014)/MG_TYPE_43.shp") %>%
mutate(CODE = ifelse(CODE == "Mi", "Unk", CODE)) %>%
arrange(CODE) %>%
mutate(CODE_NUM = 1:length(CODE)) %>%
dplyr::select(CODE, CODE_NUM)
sf_dat
lulcc2000
lulcc_df
library(cluster)
library(NbClust)
library(factoextra)
albersSEAsia <- CRS(" +proj=aea +lat_1=7 +lat_2=-32 +lat_0=-15 +lon_0=125 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs ")
epsg4326 <- CRS(" +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ")
cngwt <- st_read("./data/processed/cstl_prvncs")
cngwt_union <- st_union(cngwt) %>%
st_transform(crs = albersSEAsia)
cngwt_bffr <- st_buffer(cngwt_union, 5000) %>%
st_transform(crs = epsg4326)
tsm <- raster("../../ch1_c_estimation/analysis/data/raw/site_map/tha_mean_tsm.tif")
tdl <- raster("../../ch1_c_estimation/analysis/data/raw/site_map/m2_4326_a.tif")
tdl_new <- resample(tdl, tsm, method = "bilinear")
gmrphStack <- stack(tsm, tdl_new)
gmrphStackMskd <- mask(gmrphStack, as(cngwt_bffr, "Spatial"))
gmrph_dat <- raster::extract(gmrphStack, as(cngwt_bffr, "Spatial"), cellnumbers = T) %>%
as.data.frame()  %>%
rename(tsm = "tha_mean_tsm",
tdl = "m2_4326_a",
id = "cell")
maxClstrs <- 20
optClstrs <- data.frame(clstrs = seq(1, maxClstrs, 1),
tot_wss = NA)
for(i in 1:maxClstrs) {
kmeansClass <- kmeans(na.omit(gmrph_dat[ , c(2, 3)]), i, nstart = 30)
optClstrs$tot_wss[i] <- kmeansClass$tot.withinss
}
fviz_nbclust(na.omit(gmrph_dat[, c(2,3)]), kmeans, method = 'wss', k.max = 25, nstart = 30)
fviz_nbclust(na.omit(gmrph_dat[, c(2,3)]), kmeans, method = 'silhouette', k.max = 25, nstart = 30)
plot(optClstrs)
idx <- na.omit(gmrph_dat[ , c(1, 2, 3)])
kmeansClass <- kmeans(na.omit(gmrph_dat[ , c(2, 3)]), 3, nstart = 30)
idx <- cbind(idx, kmeansClass$cluster)
classed_dat <- gmrph_dat %>%
left_join(idx, by = c("id")) %>%
rename(class = "kmeansClass$cluster") %>%
rename(tsm = "tsm.x",
tdl = "tdl.x") %>%
dplyr::select(id, tsm, tdl, class)
classes <- gmrphStack[[1]]
values(classes) <- 0
dat <- values(classes)
vals <- dat %>%
as.data.frame() %>%
mutate(id = row_number()) %>%
left_join(classed_dat, by = "id") %>%
pull(class)
values(classes) <- vals
classesCrpd <- crop(classes, as(cngwt_bffr, "Spatial"))
classesMskd <- mask(classesCrpd, as(cngwt_bffr, "Spatial"))
plot(classesMskd)
gmrph_dat
kmeansClass <- kmeans(na.omit(gmrph_dat[ , c(2, 3)]), 2, nstart = 30)
idx <- cbind(idx, kmeansClass$cluster)
classed_dat <- gmrph_dat %>%
left_join(idx, by = c("id")) %>%
rename(class = "kmeansClass$cluster") %>%
rename(tsm = "tsm.x",
tdl = "tdl.x") %>%
dplyr::select(id, tsm, tdl, class)
classes <- gmrphStack[[1]]
values(classes) <- 0
dat <- values(classes)
vals <- dat %>%
as.data.frame() %>%
mutate(id = row_number()) %>%
left_join(classed_dat, by = "id") %>%
pull(class)
values(classes) <- vals
classesCrpd <- crop(classes, as(cngwt_bffr, "Spatial"))
classesMskd <- mask(classesCrpd, as(cngwt_bffr, "Spatial"))
plot(classesMskd)
idx <- na.omit(gmrph_dat[ , c(1, 2, 3)])
kmeansClass <- kmeans(na.omit(gmrph_dat[ , c(2, 3)]), 2, nstart = 30)
idx <- cbind(idx, kmeansClass$cluster)
classed_dat <- gmrph_dat %>%
left_join(idx, by = c("id")) %>%
rename(class = "kmeansClass$cluster") %>%
rename(tsm = "tsm.x",
tdl = "tdl.x") %>%
dplyr::select(id, tsm, tdl, class)
classes <- gmrphStack[[1]]
values(classes) <- 0
dat <- values(classes)
vals <- dat %>%
as.data.frame() %>%
mutate(id = row_number()) %>%
left_join(classed_dat, by = "id") %>%
pull(class)
values(classes) <- vals
classesCrpd <- crop(classes, as(cngwt_bffr, "Spatial"))
classesMskd <- mask(classesCrpd, as(cngwt_bffr, "Spatial"))
plot(classesMskd)
class(classesMskd)
kmeansClass <- kmeans(na.omit(gmrph_dat[ , c(2, 3)]), 4, nstart = 30)
idx <- cbind(idx, kmeansClass$cluster)
classed_dat <- gmrph_dat %>%
left_join(idx, by = c("id")) %>%
rename(class = "kmeansClass$cluster") %>%
rename(tsm = "tsm.x",
tdl = "tdl.x") %>%
dplyr::select(id, tsm, tdl, class)
classes <- gmrphStack[[1]]
values(classes) <- 0
dat <- values(classes)
vals <- dat %>%
as.data.frame() %>%
mutate(id = row_number()) %>%
left_join(classed_dat, by = "id") %>%
pull(class)
values(classes) <- vals
classesCrpd <- crop(classes, as(cngwt_bffr, "Spatial"))
classesMskd <- mask(classesCrpd, as(cngwt_bffr, "Spatial"))
idx <- na.omit(gmrph_dat[ , c(1, 2, 3)])
kmeansClass <- kmeans(na.omit(gmrph_dat[ , c(2, 3)]), 4, nstart = 30)
idx <- cbind(idx, kmeansClass$cluster)
classed_dat <- gmrph_dat %>%
left_join(idx, by = c("id")) %>%
rename(class = "kmeansClass$cluster") %>%
rename(tsm = "tsm.x",
tdl = "tdl.x") %>%
dplyr::select(id, tsm, tdl, class)
classes <- gmrphStack[[1]]
values(classes) <- 0
dat <- values(classes)
vals <- dat %>%
as.data.frame() %>%
mutate(id = row_number()) %>%
left_join(classed_dat, by = "id") %>%
pull(class)
values(classes) <- vals
classesCrpd <- crop(classes, as(cngwt_bffr, "Spatial"))
classesMskd <- mask(classesCrpd, as(cngwt_bffr, "Spatial"))
plot(classesMskd)
adm0 <- read_sf("./data/raw/tha_admbnda_adm0_rtsd_20190221.shp")
ggplot(adm0) +
geom_sf()
plot(adm0)
?geom_sf
adm0
adm0
ggplot(adm0) +
geom_sf(aes(geometry = geometry))
ggplot() +
geom_sf(data = adm0, aes(geometry = geometry))
optClstrs
classesMskd
adm0
plot(adm0)
plot(adm0$geometry)
plot(classesMskd, add = T)
ggplot()
ggplot() +
geom_sf(adm0, aes(geometry))
ggplot() +
geom_sf(data = adm0, aes(geometry))
ggplot(adm0) +
geom_sf()
plot(adm0$geometry)
plot(classesMskd, add = T)
warnings()
library(tidyverse)
library(spsurvey)
library(sf)
library(raster)
library(rgdal)
library(sp)
simard_agb <- raster("../../ch1_c_estimation/analysis/data/raw/modeled_datasets/Mangrove_agb_Thailand.tif")
simard_height <- raster("~/Desktop/mangrove_c_model_data/CMS_Global_Map_Mangrove_Canopy_1665/data/Mangrove_hmax95_Thailand.tif")
set.seed(04029189)
dat <- sampleRandom(simard_height, 10000, na.rm=T)
library(tidyverse)
library(spsurvey)
library(sf)
library(raster)
library(rgdal)
library(tidyverse)
library(spsurvey)
library(sf)
library(raster)
library(rgdal)
library(sp)
library(cluster)
library(NbClust)
library(factoextra)
albersSEAsia <- CRS(" +proj=aea +lat_1=7 +lat_2=-32 +lat_0=-15 +lon_0=125 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs ")
epsg4326 <- CRS(" +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ")
cngwt <- st_read("./data/processed/cstl_prvncs")
cngwt_union <- st_union(cngwt) %>%
st_transform(crs = albersSEAsia)
cngwt_bffr <- st_buffer(cngwt_union, 5000) %>%
st_transform(crs = epsg4326)
adm0 <- read_sf("./data/raw/tha_admbnda_adm0_rtsd_20190221.shp")
sea_adm0 <- read_sf("./data/raw/se_asia.shp")
simard_agb <- raster("../../ch1_c_estimation/analysis/data/raw/modeled_datasets/Mangrove_agb_Thailand.tif")
simard_height <- raster("~/Desktop/mangrove_c_model_data/CMS_Global_Map_Mangrove_Canopy_1665/data/Mangrove_hmax95_Thailand.tif")
simard_height
hgt_resample <- raster(nrow = 28062/3, ncol = 20575/3, crs = epsg4326)
hgt_resample
hgt_resample <- raster(nrow = 28062/3, ncol = 20575/3, crs = epsg4326, extent = c(97.39377, 103.0813, 6.116629, 13.91163))
?raster
hgt_resample <- raster(nrow = 28062/3, ncol = 20575/3, crs = epsg4326, ext = extent(simard_height))
hgt_resample
simard_height
resample(simard_height, hgt_resample, method = "bilinear")
simard_height_rsmpl <- resample(simard_height, hgt_resample, method = "bilinear")
simard_height_df <- as.data.frame(simard_height_rsmpl, xy = T, na.rm = T)
colnames(simard_height_df) <- c("hgt", "x", "y")
head(simard_height_df)
ggplot(sea_adm0) +
geom_sf(fill = "#F2F2F2") +
geom_sf(data = adm0, aes(geometry = geometry), fill = "#E5E5E5") +
geom_raster(data = simard_height_df, aes(x = x, y = y, fill = hgt)) +
theme_bw() +
xlab("") +
ylab("") +
labs(fill = "Cluster") +
xlim(c(98, 105)) +
ylim(c(5, 15)) +
ggtitle("no. clusters = 4") +
theme(legend.position = "bottom")
ggplot(sea_adm0) +
geom_sf(fill = "#F2F2F2") +
geom_sf(data = adm0, aes(geometry = geometry), fill = "#E5E5E5") +
geom_raster(data = simard_height_df, aes(x = x, y = y, fill = hgt)) +
theme_bw() +
xlab("") +
ylab("") +
labs(fill = "Cluster") +
#coord_sf(xlim = c(99.85, 100.05), ylim = c(13.2, 13.4)) +
xlim(c(99.85, 100.05)) +
ylim(c(13.2, 13.4)) +
ggtitle("no. clusters = 4") +
theme(legend.position = "bottom")
simard_height_df
hist(simard_height_df$hgt)
ggplot(simard_height_df) +
geom_histogram()
ggplot(simard_height_df) +
geom_histogram(aes(bins = 30, y = hgt))
?geom_histogram
ggplot(simard_height_df, aes(hgt)) +
geom_histogram()
source('~/Dropbox/manuscripts/ch2_luc/analysis/scripts/spatial_analyses.R', echo=TRUE)
ggplot(simard_height_df, aes(hgt)) +
geom_histogram() +
theme_bw()
?geom_histogram
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw()
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 10) +
theme_bw()
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw()
simard_height_df <- as.data.frame(simard_height, xy = T, na.rm = T)
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw()
colnames(simard_height_df) <- c("hgt", "x", "y")
colnames(simard_height_df_rs) <- c("hgt", "x", "y")
colnames(simard_height_df) <- c("hgt", "x", "y")
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw()
simard_height_df
simard_height_df_rs
simard_height_df_rs <- as.data.frame(simard_height_rsmpl, xy = T, na.rm = T)
colnames(simard_height_df_rs) <- c("hgt", "x", "y")
nrow(simard_height_df_rs)
nrow(simard_height_df)
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw()
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 30) +
theme_bw()
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 10) +
theme_bw()
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 15) +
theme_bw()
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw()
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw() +
xlab("Mean mangrove canopy height, 30 x 30 m (m)")
ggplot(simard_height_df, aes(hgt)) +
geom_histogram(bins = 20) +
theme_bw() +
xlab("Mean mangrove canopy height, 30 x 30 m (m)") +
ylab("Count")
getJenksBreaks(simard_height_df$hgt, 5)
install.packages("BAMMtools")
getJenksBreaks(simard_height_df$hgt, 5)
library(BAMMtools)
getJenksBreaks(simard_height_df$hgt, 5)
runif(8)
round(runif(8)*10)
sample(8, 1:8)
sample(1:8)
library(cluster)
library(factoextra)
library(gdalUtils)
library(NbClust)
library(raster)
library(rgdal)
library(sf)
library(sp)
library(spsurvey)
library(tidyverse)
raw_dir <- "./data/raw/"
in_dir <- "./data/processed/"
scratch_dir <- "./data/scratch/"
chngwts <- read_sf(paste0(in_dir, "cstl_prvncs/cstl_prvncs.shp"))
soc <- raster(paste0(raw_dir, "rasters/Mangrove_soc_Thailand.tif"))
agb <- raster(paste0(raw_dir, "rasters/Mangrove_agb_Thailand.tif"))
