method.args = list(formula = y ~ a / (1 + b * exp(1) ^ (-k * x)),
start = list(a = 140, b = 13, k = 0.1)),
data = prop_df,
se = FALSE,
color = "black",
linetype = "dashed",
aes(x = yr, y = lwr)) +
geom_smooth(method = "nls",
method.args = list(formula = y ~ a / (1 + b * exp(1) ^ (-k * x)),
start = list(a = 140, b = 13, k = 0.1)),
data = prop_df,
se = FALSE,
color = "black",
linetype = "dashed",
aes(x = yr, y = upr)) +
ylab("AGC (Mg / ha)") +
xlab("Time Since Regeneration (Years)") +
annotate("text", x = 18, y = 225, label = "t = 14", col = "red") +
geom_vline(xintercept = 14, linetype = "dashed", color = "red") +
theme_tufte() +
theme(panel.grid.minor = element_blank(),
panel.grid.major = element_blank())
fig3_growthMdl
ggsave("./figs/fig2_growth.jpg", fig3_growthMdl, width = 8, height = 5, units = c("in"), device = "jpeg")
system("bash ./scripts/resample_rasters.sh")
districts <- st_read(paste0(raw_dir, "shapefiles/tha_admbnda_adm2_rtsd_20190221.shp"))
library(raster)
library(rgdal)
library(sf)
library(sp)
library(tidyverse)
raw_dir <- "./data/raw/"
out_dir <- "./data/processed/"
districts <- st_read(paste0(raw_dir, "shapefiles/tha_admbnda_adm2_rtsd_20190221.shp"))
mg2000 <- st_transform(st_read(paste0(in_dir, "shapefiles/MG_TYPE_43.shp")), 4326)
mg2000 <- st_transform(st_read(paste0(eQ_dir, "shapefiles/MG_TYPE_43.shp")), 4326)
mg2000 <- st_transform(st_read(paste0(raw_dir, "shapefiles/MG_TYPE_43.shp")), 4326)
intersections <- st_intersects(districts, mg2000)
districts_mg <- districts[lengths(intersections) > 0, ]
plot(districts_mg["ADM1_EN"])
plot(mg2000["CODE"], add = T)
plot(mg2000["CODE"], add = T)
st_write(districts_mg, dsn = paste0(out_dir, "shapefiles/districts_mg"), layer = "districts_mg", driver = "ESRI Shapefile")
st_write(districts_mg, dsn = paste0(out_dir, "shapefiles/districts_mg"),
layer = "districts_mg", driver = "ESRI Shapefile", append = FALSE)
rm(list = ls())
gc()
print("End of Step 1. Processing of raw data")
?st_read
print("Running Step 2. land use and land cover change analysis...")
library(raster)
library(rgdal)
library(sf)
library(sp)
library(spsurvey)
library(tidyverse)
raw_dir <- "./data/raw/"
proc_dir <- "./data/processed/"
table_dir <- "./tables/"
mg2000 <- raster(paste0(proc_dir, "rasters/mg2000.tif"))
mg2014 <- raster(paste0(proc_dir, "rasters/mg2014.tif"))
ct <- crosstab(mg2000, mg2014, useNA = T)
ct_df <- as.data.frame.matrix(ct)
ct_df_ha <- ct_df * 937 / 10000 / 1000
ct_df_ha$ttl <- rowSums(ct_df_ha)
ct_df_ha <- rbind(ct_df_ha, colSums(ct_df_ha))
ct_df_ha
View(ct_df_ha)
write_csv(ct_df_ha, "~/Desktop/dat.csv")
dstrcts <- read_sf(paste0(proc_dir, "shapefiles/districts_mg/districts_mg.shp")) %>%
mutate(ADM2_ID = row_number()) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN)
dstrct_df <- dstrcts
st_geometry(dstrct_df) <- NULL
loss_codes <- data.frame(district = NA, code = factor(c(1, 2, 3, 4, 5, 7, 8, 9, 10, 11, NA)))
gain_codes <- data.frame(district = NA, code = factor(c(1, 2, 3, 4, 5, 6, 7, 9, 10, NA)))
losses <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA,
salt_farms = NA, urban = NA, water = NA, nodata = NA)
gains <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA,
salt_farms = NA, urban = NA, nodata = NA)
for(i in 1:1) {
dstrct <- dstrcts[i, ]
mg2000_crp <- crop(mg2000, dstrct)
mg2014_crp <- crop(mg2014, dstrct)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
rm(dstrct, mg2000_crp, mg2014_crp, ct, ct_df,
ct_loss, ct_gain, loss_vctr, gain_vctr)
}
losses <- losses %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water, nodata)
losses <- losses %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms,
urban, water, nodata)
losses_total <- losses %>%
summarize(
ADM2_ID = 9999,
ADM2_EN = "Total",
ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
dstrct_losses <- bind_rows(losses, losses_total)
gains <- gains %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms,
urban, nodata)
gains_total <- gains %>%
summarize(
ADM2_ID = 9999,
ADM2_EN = "Total",
ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
dstrct_gains <- bind_rows(gains, gains_total)
for(i in 1:nrow(dstrcts)) {
dstrct <- dstrcts[i, ]
mg2000_crp <- crop(mg2000, dstrct)
mg2014_crp <- crop(mg2014, dstrct)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
rm(dstrct, mg2000_crp, mg2014_crp, ct, ct_df,
ct_loss, ct_gain, loss_vctr, gain_vctr)
}
losses <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA,
salt_farms = NA, urban = NA, water = NA, nodata = NA)
loss_codes <- data.frame(district = NA, code = factor(c(1, 2, 3, 4, 5, 7, 8, 9, 10, 11, NA)))
gain_codes <- data.frame(district = NA, code = factor(c(1, 2, 3, 4, 5, 6, 7, 9, 10, NA)))
losses <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA,
salt_farms = NA, urban = NA, water = NA, nodata = NA)
gains <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA,
salt_farms = NA, urban = NA, nodata = NA)
write_csv(ct_df_ha, "~/Desktop/dat.csv")
loss_codes
gain_codes
losses
loss_codes <- data.frame(district = NA, code = factor(c(1, 2, 3, 4, 5, 7, 9, 10, 11, NA)))
gain_codes <- data.frame(district = NA, code = factor(c(1, 2, 3, 4, 5, 7, 9, 10, NA)))
losses <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, salt_farms = NA,
urban = NA, water = NA, nodata = NA)
gains <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, salt_farms = NA,
urban = NA, nodata = NA)
for(i in 1:nrow(dstrcts)) {
dstrct <- dstrcts[i, ]
mg2000_crp <- crop(mg2000, dstrct)
mg2014_crp <- crop(mg2014, dstrct)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
rm(dstrct, mg2000_crp, mg2014_crp, ct, ct_df,
ct_loss, ct_gain, loss_vctr, gain_vctr)
}
losses <- losses %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms,
urban, water, nodata)
losses_total <- losses %>%
summarize(
ADM2_ID = 9999,
ADM2_EN = "Total",
ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
dstrct_losses <- bind_rows(losses, losses_total)
gains <- gains %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms,
urban, nodata)
gains_total <- gains %>%
summarize(
ADM2_ID = 9999,
ADM2_EN = "Total",
ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
dstrct_gains <- bind_rows(gains, gains_total)
epsg102028 <- CRS("+proj=aea +lat_1=7 +lat_2=-32 +lat_0=-15 +lon_0=125
+x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs")
pxlSize <- 927 # Hard code it to save time, but lines above produce same result
dstrct_losses_ha <- dstrct_losses
dstrct_losses_ha[, 4:14] <- round(dstrct_losses[, 4:14] * pxlSize / 10000, 2)
dstrct_losses+ha
dstrct_losses_ha
dstrct_losses_ha[, 4:13] <- round(dstrct_losses[, 4:13] * pxlSize / 10000, 2)
dstrct_gains_ha <- dstrct_gains
ncol(dstrct_gains_ha)
dstrct_gains_ha[, 4:12] <- round(dstrct_gains[, 4:12] * pxlSize / 10000, 2)
dstrcts_loss_sf <- dstrcts %>%
left_join(dstrct_losses_ha, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, abandoned, sand, salt_farms, urban,
water, nodata, geometry)
dstrcts_loss_sf <- dstrcts %>%
left_join(dstrct_losses_ha, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, abandoned, salt_farms, urban,
water, nodata, geometry)
dstrcts_gain_sf <- dstrcts %>%
left_join(dstrct_gains_ha, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, abandoned, salt_farms, urban,
nodata, geometry)
st_write(dstrcts_loss_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_losses_2014"), layer = "dstrct_losses_2014", driver = "ESRI Shapefile")
st_write(dstrcts_gain_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_gains_2014"), layer = "dstrct_gains_2014", driver = "ESRI Shapefile")
st_write(dstrcts_loss_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_losses_2014"),
layer = "dstrct_losses_2014", driver = "ESRI Shapefile", append = FALSE)
st_write(dstrcts_gain_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_gains_2014"),
layer = "dstrct_gains_2014", driver = "ESRI Shapefile", append = FALSE)
rm(list = ls())
mg2000 <- raster(paste0(proc_dir, "rasters/mg2000.tif"))
raw_dir <- "./data/raw/"
proc_dir <- "./data/processed/"
table_dir <- "./tables/"
mg2000 <- raster(paste0(proc_dir, "rasters/mg2000.tif"))
dstrcts <- read_sf(paste0(proc_dir, "shapefiles/districts_mg")) %>%
mutate(ADM2_ID = row_number()) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN)
loss_codes_00 <- data.frame(district = NA, code = c(1, 2, 3, 4, 5, 6, 7, 9, 10))
loss_codes_14 <- data.frame(district = NA, code = c(1, 2, 3, 4, 5, 7, 8, 9, 10, 11))
losses_2000 <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, mines = NA, abandoned = NA,
salt_farms = NA, urban = NA)
losses_2014 <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, sand = NA,
salt_farms = NA, urban = NA, water = NA)
areaRaster <- area(mg2000)
loss_codes_00 <- data.frame(district = NA, code = c(1, 2, 3, 4, 5, 7, 9, 10))
loss_codes_14 <- data.frame(district = NA, code = c(1, 2, 3, 4, 5, 8, 9, 10, 11))
losses_2000 <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, salt_farms = NA,
urban = NA)
losses_2014 <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, salt_farms = NA,
urban = NA, water = NA)
areaRaster <- area(mg2000)
loss_codes_00 <- data.frame(district = NA, code = c(1, 2, 3, 4, 5, 7, 9, 10))
loss_codes_14 <- data.frame(district = NA, code = c(1, 2, 3, 4, 5, 7, 9, 10, 11))
losses_2000 <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, salt_farms = NA,
urban = NA)
losses_2014 <- data.frame(district = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, salt_farms = NA,
urban = NA, water = NA)
for(i in 1:1 {
for(i in 1:1) {
shp <- dstrcts[i, ]
cropDat_00 <- crop(mg2000, shp)
clipDat_00 <- mask(cropDat_00, shp)
cropDat_14 <- crop(mg2014, shp)
clipDat_14 <- mask(cropDat_14, shp)
crop_areaRast <- crop(areaRaster, shp)
zonalSums_00 <- as.data.frame(zonal(crop_areaRast, clipDat_00, fun = "sum"))
zonalSums_14 <- as.data.frame(zonal(crop_areaRast, clipDat_14, fun = "sum"))
vctr_00 <- loss_codes_00 %>%
left_join(zonalSums_00, by = c("code" = "zone")) %>%
pull(sum)
vctr_14 <- loss_codes_14 %>%
left_join(zonalSums_14, by = c("code" = "zone")) %>%
pull(sum)
losses_2000[i, ] <- c(i, vctr_00 * 100)  # Multiply by 100 to convert from km^2 to ha
losses_2014[i, ] <- c(i, vctr_14 * 100)
}
mg2014 <- raster(paste0(proc_dir, "rasters/mg2014.tif"))
for(i in 1:1) {
shp <- dstrcts[i, ]
cropDat_00 <- crop(mg2000, shp)
clipDat_00 <- mask(cropDat_00, shp)
cropDat_14 <- crop(mg2014, shp)
clipDat_14 <- mask(cropDat_14, shp)
crop_areaRast <- crop(areaRaster, shp)
zonalSums_00 <- as.data.frame(zonal(crop_areaRast, clipDat_00, fun = "sum"))
zonalSums_14 <- as.data.frame(zonal(crop_areaRast, clipDat_14, fun = "sum"))
vctr_00 <- loss_codes_00 %>%
left_join(zonalSums_00, by = c("code" = "zone")) %>%
pull(sum)
vctr_14 <- loss_codes_14 %>%
left_join(zonalSums_14, by = c("code" = "zone")) %>%
pull(sum)
losses_2000[i, ] <- c(i, vctr_00 * 100)  # Multiply by 100 to convert from km^2 to ha
losses_2014[i, ] <- c(i, vctr_14 * 100)
}
losses_00 <- losses_2000 %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, mines, abandoned, salt_farms, urban)
dstrct_df <- dstrcts
st_geometry(dstrct_df) <- NULL
losses_00 <- losses_2000 %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, mines, abandoned, salt_farms, urban)
losses_00 <- losses_2000 %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms, urban)
losses_14 <- losses_2014 %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms, urban,
water)
losses_14 <- losses_2014 %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms, urban,
water)
losses_ttl_00 <- losses_00 %>%
summarize(ADM2_ID = 9999, ADM2_EN = "Total", ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T))
losses_ttl_14 <- losses_14 %>%
summarize(ADM2_ID = 9999, ADM2_EN = "Total", ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T))
dstrct_ttls_2000 <- bind_rows(losses_00, losses_ttl_00) %>%
rowwise() %>%
mutate(total = sum(aquaculture, agriculture, mangrove, other_forest, mudflats,
mines, abandoned, salt_farms, urban, na.rm = T)) %>%
ungroup()
dstrct_ttls_2000 <- bind_rows(losses_00, losses_ttl_00) %>%
rowwise() %>%
mutate(total = sum(aquaculture, agriculture, mangrove, other_forest, mudflats,
abandoned, salt_farms, urban, na.rm = T)) %>%
ungroup()
dstrct_ttls_2014 <- bind_rows(losses_14, losses_ttl_14) %>%
rowwise() %>%
mutate(total = sum(aquaculture, agriculture, mangrove, other_forest, mudflats,
abandoned, salt_farms, urban, water, na.rm = T)) %>%
ungroup()
dstrct_ttls_2000_sf <- dstrcts %>%
left_join(dstrct_ttls_2000, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
arrange(ADM1_EN, ADM2_EN) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, mines, abandoned, salt_farms, urban, total, geometry)
dstrct_ttls_2000_sf <- dstrcts %>%
left_join(dstrct_ttls_2000, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
arrange(ADM1_EN, ADM2_EN) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, abandoned, salt_farms, urban, total, geometry)
dstrct_ttls_2014_sf <- dstrcts %>%
left_join(dstrct_ttls_2014, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
arrange(ADM1_EN, ADM2_EN) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, abandoned, salt_farms, urban, water, total, geometry)
for(i in 1:nrow(dstrcts)) {
shp <- dstrcts[i, ]
cropDat_00 <- crop(mg2000, shp)
clipDat_00 <- mask(cropDat_00, shp)
cropDat_14 <- crop(mg2014, shp)
clipDat_14 <- mask(cropDat_14, shp)
crop_areaRast <- crop(areaRaster, shp)
zonalSums_00 <- as.data.frame(zonal(crop_areaRast, clipDat_00, fun = "sum"))
zonalSums_14 <- as.data.frame(zonal(crop_areaRast, clipDat_14, fun = "sum"))
vctr_00 <- loss_codes_00 %>%
left_join(zonalSums_00, by = c("code" = "zone")) %>%
pull(sum)
vctr_14 <- loss_codes_14 %>%
left_join(zonalSums_14, by = c("code" = "zone")) %>%
pull(sum)
losses_2000[i, ] <- c(i, vctr_00 * 100)  # Multiply by 100 to convert from km^2 to ha
losses_2014[i, ] <- c(i, vctr_14 * 100)
}
losses_00 <- losses_2000 %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms, urban)
losses_14 <- losses_2014 %>%
left_join(dstrct_df, by = c("district" = "ADM2_ID")) %>%
select(ADM2_ID = district, ADM2_EN, ADM1_EN, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, salt_farms, urban, water)
losses_ttl_00 <- losses_00 %>%
summarize(ADM2_ID = 9999, ADM2_EN = "Total", ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T))
losses_ttl_14 <- losses_14 %>%
summarize(ADM2_ID = 9999, ADM2_EN = "Total", ADM1_EN = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T))
dstrct_ttls_2000 <- bind_rows(losses_00, losses_ttl_00) %>%
rowwise() %>%
mutate(total = sum(aquaculture, agriculture, mangrove, other_forest, mudflats,
abandoned, salt_farms, urban, na.rm = T)) %>%
ungroup()
dstrct_ttls_2014 <- bind_rows(losses_14, losses_ttl_14) %>%
rowwise() %>%
mutate(total = sum(aquaculture, agriculture, mangrove, other_forest, mudflats,
abandoned, salt_farms, urban, water, na.rm = T)) %>%
ungroup()
dstrct_ttls_2000_sf <- dstrcts %>%
left_join(dstrct_ttls_2000, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
arrange(ADM1_EN, ADM2_EN) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, abandoned, salt_farms, urban, total, geometry)
dstrct_ttls_2014_sf <- dstrcts %>%
left_join(dstrct_ttls_2014, by = c("ADM1_EN", "ADM2_ID", "ADM2_EN")) %>%
arrange(ADM1_EN, ADM2_EN) %>%
dplyr::select(ADM1_EN, ADM2_ID, ADM2_EN, aquaculture, agriculture, mangrove,
other_forest, mudflats, abandoned, salt_farms, urban, water, total, geometry)
st_write(dstrct_ttls_2000_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_ttls_2000"), layer = "dstrct_ttls_2000", driver = "ESRI Shapefile")
st_write(dstrct_ttls_2014_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_ttls_2014"), layer = "dstrct_ttls_2014", driver = "ESRI Shapefile")
st_write(dstrct_ttls_2000_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_ttls_2000"),
layer = "dstrct_ttls_2000", driver = "ESRI Shapefile", append = FALSE)
st_write(dstrct_ttls_2014_sf, dsn = paste0(proc_dir, "shapefiles/dstrct_ttls_2014"),
layer = "dstrct_ttls_2014", driver = "ESRI Shapefile", append = FALSE)
