mutate(ADM1_ID = n())
prvnc_df <- prvncs %>%
mutate(ADM1_ID = n())
prvnc_df
prvnc_df <- prvncs %>%
mutate(ADM1_ID = row_number())
prvnc_df
st_geometry(prvnc_df) <- NULL
prvnc_df
prvncs <- st_read(paste0(in_dir, "cstl_prvncs/cstl_prvncs.shp"))%>%
mutate(ADM1_ID = row_number()) %>%
dplyr::select(ADM1_EN, ADM1_ID, region)
prvnc_df <- prvncs
st_geometry(prvnc_df) <- NULL
prvnc_df
losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID"))
losses <- loss
losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID"))
losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water)
losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water)
prvnc <- prvncs[1, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
loss_vctr
rm(list = ls())
library(raster)
library(rgdal)
library(sf)
library(sp)
library(spsurvey)
library(tidyverse)
raw_dir <- "./data/raw/"
in_dir <- "./data/processed/"
table_dir <- "./tables/"
mg2000 <- raster(paste0(in_dir, "rasters/mg2000.tif"))
mg2014 <- raster(paste0(in_dir, "rasters/mg2014.tif"))
prvncs <- st_read(paste0(in_dir, "cstl_prvncs/cstl_prvncs.shp"))%>%
mutate(ADM1_ID = row_number()) %>%
dplyr::select(ADM1_EN, ADM1_ID, region)
prvnc_df <- prvncs
st_geometry(prvnc_df) <- NULL
loss_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 7, 8, 9, 10, 11)))
gain_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 6, 7, 9, 10)))
losses <- data.frame(province = NA, aquaculture = NA, agriculture = NA,
mangrove = NA, other_forest = NA,
mudflats = NA, abandoned = NA, sand = NA,
salt_farms = NA, urban = NA, water = NA)
gains <- data.frame(province = NA, aquaculture = NA, agriculture = NA,
mangrove = NA, other_forest = NA,
mudflats = NA, mines = NA, abandoned = NA,
salt_farms = NA, urban = NA)
for(i in 1:nrow(prvncs)) {
prvnc <- prvncs[i, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
# Extract gains
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
}
losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water)
gains %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, mines, abandoned, salt_farms, urban)
crosstab
crosstab()
?crosstab
for(i in 1:1) {
prvnc <- prvncs[i, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
}
losses
loss_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 7, 8, 9, 10, 11)))
gain_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 6, 7, 9, 10)))
losses <- data.frame(province = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, sand = NA,
salt_farms = NA, urban = NA, water = NA)
gains <- data.frame(province = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, mines = NA, abandoned = NA,
salt_farms = NA, urban = NA)
losses
for(i in 1:1) {
prvnc <- prvncs[i, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
}
losses
prvnc <- prvncs[1, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct
ct <- crosstab(mg2000, mg2014, useNA = T)
ct
ct_df <- as.data.frame.matrix(ct)
ct_df
sum(ct_df$3
sum(ct_df$3)
sum(ct_df[,3])
sum(ct_df[,3]) * 925.76
sum(ct_df[,3]) * 925.76 / 10000
sum(ct_df[3,]) * 925.76 / 10000
loss_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 7, 8, 9, 10, 11, NA)))
gain_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 6, 7, 9, 10, NA)))
losses <- data.frame(province = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, sand = NA,
salt_farms = NA, urban = NA, water = NA, nodata = NA)
gains <- data.frame(province = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, mines = NA, abandoned = NA,
salt_farms = NA, urban = NA, nodata = NA)
for(i in 1:1) {
prvnc <- prvncs[i, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
}
losses
gains
for(i in 1:nrow(prvncs)) {
prvnc <- prvncs[i, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
}
losses
gains
losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water)
gains %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, mines, abandoned, salt_farms, urban)
losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water, nodata)
gains %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, mines, abandoned, salt_farms,
urban, nodata)
losses %>% summarize(
ADM1_EN = "Total",
ADM1_ID = "9999",
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
mines = sum(mines, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
losses %>% summarize(
ADM1_EN = "Total",
ADM1_ID = "9999",
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
sand = sum(sand, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
losses_total <- losses %>%
summarize(
ADM1_EN = "Total",
ADM1_ID = "9999",
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
sand = sum(sand, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
losses <- losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water, nodata)
losses_total <- losses %>%
summarize(
ADM1_EN = "Total",
ADM1_ID = "9999",
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
sand = sum(sand, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
losses <- bind_rows(losses, losses_total)
losses_total <- losses %>%
summarize(
ADM1_EN = "Total",
ADM1_ID = 9999,
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
sand = sum(sand, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
losses <- bind_rows(losses, losses_total)
losses
rm(mg2000_crp, mg2014_crp, ct, ct_df, ct_loss, ct_gain, loss_vctr, gain_vctr)
rm(prvnc, mg2000_crp, mg2014_crp, ct, ct_df,
ct_loss, ct_gain, loss_vctr, gain_vctr)
gains
gains_total <- gains %>%
summarize(
ADM1_EN = "Total",
ADM1_ID = 9999,
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
mines = sum(mines, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
gains <- bind_rows(gains, gains_total)
gains
gains <- gains %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, mines, abandoned, salt_farms,
urban, nodata)
gains_total <- gains %>%
summarize(
ADM1_EN = "Total",
ADM1_ID = 9999,
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
mines = sum(mines, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
gains <- bind_rows(gains, gains_total)
gains
rm(list = ls())
print("Running Step 2. land use and land cover change analysis...")
library(raster)
library(rgdal)
library(sf)
library(sp)
library(spsurvey)
library(tidyverse)
raw_dir <- "./data/raw/"
in_dir <- "./data/processed/"
table_dir <- "./tables/"
mg2000 <- raster(paste0(in_dir, "rasters/mg2000.tif"))
mg2014 <- raster(paste0(in_dir, "rasters/mg2014.tif"))
ct <- crosstab(mg2000, mg2014, useNA = T)
ct_df <- as.data.frame.matrix(ct)
prvncs <- st_read(paste0(in_dir, "cstl_prvncs/cstl_prvncs.shp"))%>%
mutate(ADM1_ID = row_number()) %>%
dplyr::select(ADM1_EN, ADM1_ID, region)
prvnc_df <- prvncs
st_geometry(prvnc_df) <- NULL
loss_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 7, 8, 9, 10, 11, NA)))
gain_codes <- data.frame(province = NA, code = factor(c(1, 2, 3, 4, 5, 6, 7, 9, 10, NA)))
losses <- data.frame(province = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, abandoned = NA, sand = NA,
salt_farms = NA, urban = NA, water = NA, nodata = NA)
gains <- data.frame(province = NA, aquaculture = NA, agriculture = NA, mangrove = NA,
other_forest = NA, mudflats = NA, mines = NA, abandoned = NA,
salt_farms = NA, urban = NA, nodata = NA)
for(i in 1:nrow(prvncs)) {
prvnc <- prvncs[i, ]
mg2000_crp <- crop(mg2000, prvnc)
mg2014_crp <- crop(mg2014, prvnc)
ct <- crosstab(mg2000_crp, mg2014_crp, useNA = T)
ct_df <- data.frame(ct)
ct_loss <- filter(ct_df, mg2000 == 3)
ct_gain <- filter(ct_df, mg2014 == 3)
# Extract losses & gains vectors
loss_vctr <- loss_codes %>%
left_join(ct_loss, by = c("code" = "mg2014")) %>%
pull(Freq)
gain_vctr <- gain_codes %>%
left_join(ct_gain, by = c("code" = "mg2000")) %>%
pull(Freq)
# Write to final tables
losses[i , ] <- c(i, loss_vctr)
gains[i, ] <- c(i, gain_vctr)
rm(prvnc, mg2000_crp, mg2014_crp, ct, ct_df,
ct_loss, ct_gain, loss_vctr, gain_vctr)
}
losses <- losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_EN, ADM1_ID = province, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water, nodata)
losses_total <- losses %>%
summarize(
ADM1_EN = "Total",
ADM1_ID = 9999,
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
sand = sum(sand, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
water = sum(water, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
prvnc_losses <- bind_rows(losses, losses_total)
prvnc_losses
mg2014
resolution(mg2014)
losses <- losses %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_ID = province, ADM1_EN, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, abandoned, sand, salt_farms,
urban, water, nodata)
mg2014_102028 <- st_transform(mg2014_102028, crs("EPSG:102028"))
mg2014_102028 <- st_transform(mg2014, crs("EPSG:102028"))
??raser
??raster
mg2014_102028 <- projectRaster(mg2014, crs("EPSG:102028"))
mg2014_102028 <- projectRaster(mg2014,"EPSG:102028")
mg2014_102028 <- projectRaster(mg2014,"102028")
mg2014_102028 <- projectRaster(mg2014, epsg102028)
epsg102028 <- CRS("+proj=aea +lat_1=7 +lat_2=-32 +lat_0=-15 +lon_0=125
+x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs")
mg2014_102028 <- projectRaster(mg2014, epsg102028)
mg2014_102028 <- projectRaster(mg2014, crs=epsg102028)
mg2014_102028
30.9 * 30
resolution(mg2014_102028)
res(mg2014_102028)
xres(mg2014_102028)
yxres(mg2014_102028)
pxlSize <- xres(mg2014_102028) * yres(mg2014_102028)
pxlSize
head(prvnc_losses)
head(prvnc_losses)[, 4:14]
prvnc_losses_ha <- prvnc_losses
head(prvnc_losses_ha)[, 4:14] <- head(prvnc_losses[, 4:14])
head(prvnc_losses_ha)[, 4:14] <- prvnc_losses[, 4:14] * pxlSize / 10000
prvnc_losses_ha[, 4:14] <- prvnc_losses[, 4:14] * pxlSize / 10000
head(prvnc_losses_ha)
prvnc_losses_ha[, 4:14] <- round(prvnc_losses[, 4:14] * pxlSize / 10000, 2)
prvnc_losses_ha <- prvnc_losses
prvnc_losses_ha[, 4:14] <- round(prvnc_losses[, 4:14] * pxlSize / 10000, 2)
head(prvnc_losses_ha)
head(prvnc_gains)
gains <- gains %>%
left_join(prvnc_df, by = c("province" = "ADM1_ID")) %>%
select(ADM1_ID = province, ADM1_EN, region, aquaculture, agriculture,
mangrove, other_forest, mudflats, mines, abandoned, salt_farms,
urban, nodata)
gains_total <- gains %>%
summarize(
ADM1_ID = 9999,
ADM1_EN = "Total",
region = "all",
aquaculture = sum(aquaculture, na.rm = T),
agriculture = sum(agriculture, na.rm = T),
mangrove = sum(mangrove, na.rm = T),
other_forest = sum(other_forest, na.rm = T),
mudflats = sum(mudflats, na.rm = T),
mines = sum(mines, na.rm = T),
abandoned = sum(abandoned, na.rm = T),
salt_farms = sum(salt_farms, na.rm = T),
urban = sum(urban, na.rm = T),
nodata = sum(nodata, na.rm = T)
)
prvnc_gains <- bind_rows(gains, gains_total)
head(prvnc_gains)
prvnc_gains_ha <- prvnc_gains
prvnc_gains_ha[, 4:13]
prvnc_gains_ha[, 4:13] %>% head
prvnc_gains_ha[, 4:13] <- round(prvnc_gains[, 4:13] * pxlSize / 10000, 2)
prvnc_gains_ha
head(prvnc_gains_ha)
